import{m as Ht,I as xt,n as Gt,D as Yt,o as Xt,c as Oe,Q as yt,p as Tt,V as ye,P as bt,O as wt,q as Be,r as Ze,s as Rt,H as Ce,F as He,t as ze,u as dt,T as Wt,R as jt,v as Kt}from"./three-8b24794f.js";import{u as mt}from"./fflate-dcdcf726.js";const qt=se=>se&&se.isCubeTexture;class en extends Ht{constructor(A,K){var r,fe;const ve=qt(A),b=((fe=ve?(r=A.image[0])==null?void 0:r.width:A.image.width)!=null?fe:1024)/4,L=Math.floor(Math.log2(b)),De=Math.pow(2,L),B=3*Math.max(De,16*7),J=4*De,_e=[ve?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/B}`,`#define CUBEUV_TEXEL_HEIGHT ${1/J}`,`#define CUBEUV_MAX_MIP ${L}.0`],ge=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,Te=_e.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <encodings_fragment>
        }
        `,pe={map:{value:A},height:{value:(K==null?void 0:K.height)||15},radius:{value:(K==null?void 0:K.radius)||100}},me=new xt(1,16),le=new Gt({uniforms:pe,fragmentShader:Te,vertexShader:ge,side:Yt});super(me,le)}set radius(A){this.material.uniforms.radius.value=A}get radius(){return this.material.uniforms.radius.value}set height(A){this.material.uniforms.height.value=A}get height(){return this.material.uniforms.height.value}}var Vt=Object.defineProperty,$t=(se,A,K)=>A in se?Vt(se,A,{enumerable:!0,configurable:!0,writable:!0,value:K}):se[A]=K,y=(se,A,K)=>($t(se,typeof A!="symbol"?A+"":A,K),K);const At=(se,A)=>(se%A+A)%A;class tn extends Xt{constructor(A,K){super(),y(this,"object"),y(this,"domElement"),y(this,"enabled",!0),y(this,"target",new Oe),y(this,"minDistance",0),y(this,"maxDistance",1/0),y(this,"minZoom",0),y(this,"maxZoom",1/0),y(this,"minPolarAngle",0),y(this,"maxPolarAngle",Math.PI),y(this,"minAzimuthAngle",-1/0),y(this,"maxAzimuthAngle",1/0),y(this,"enableDamping",!1),y(this,"dampingFactor",.05),y(this,"enableZoom",!0),y(this,"zoomSpeed",1),y(this,"enableRotate",!0),y(this,"rotateSpeed",1),y(this,"enablePan",!0),y(this,"panSpeed",1),y(this,"screenSpacePanning",!0),y(this,"keyPanSpeed",7),y(this,"autoRotate",!1),y(this,"autoRotateSpeed",2),y(this,"reverseOrbit",!1),y(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),y(this,"mouseButtons",{LEFT:Be.ROTATE,MIDDLE:Be.DOLLY,RIGHT:Be.PAN}),y(this,"touches",{ONE:Ze.ROTATE,TWO:Ze.DOLLY_PAN}),y(this,"target0"),y(this,"position0"),y(this,"zoom0"),y(this,"_domElementKeyEvents",null),y(this,"getPolarAngle"),y(this,"getAzimuthalAngle"),y(this,"setPolarAngle"),y(this,"setAzimuthalAngle"),y(this,"getDistance"),y(this,"listenToKeyEvents"),y(this,"saveState"),y(this,"reset"),y(this,"update"),y(this,"connect"),y(this,"dispose"),this.object=A,this.domElement=K,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>B.phi,this.getAzimuthalAngle=()=>B.theta,this.setPolarAngle=a=>{let p=At(a,2*Math.PI),f=B.phi;f<0&&(f+=2*Math.PI),p<0&&(p+=2*Math.PI);let O=Math.abs(p-f);2*Math.PI-O<O&&(p<f?p+=2*Math.PI:f+=2*Math.PI),J.phi=p-f,r.update()},this.setAzimuthalAngle=a=>{let p=At(a,2*Math.PI),f=B.theta;f<0&&(f+=2*Math.PI),p<0&&(p+=2*Math.PI);let O=Math.abs(p-f);2*Math.PI-O<O&&(p<f?p+=2*Math.PI:f+=2*Math.PI),J.theta=p-f,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=a=>{a.addEventListener("keydown",lt),this._domElementKeyEvents=a},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(fe),r.update(),L=b.NONE},this.update=(()=>{const a=new Oe,p=new yt().setFromUnitVectors(A.up,new Oe(0,1,0)),f=p.clone().invert(),O=new Oe,W=new yt,q=2*Math.PI;return function(){const vt=r.object.position;a.copy(vt).sub(r.target),a.applyQuaternion(p),B.setFromVector3(a),r.autoRotate&&L===b.NONE&&$(Z()),r.enableDamping?(B.theta+=J.theta*r.dampingFactor,B.phi+=J.phi*r.dampingFactor):(B.theta+=J.theta,B.phi+=J.phi);let d=r.minAzimuthAngle,oe=r.maxAzimuthAngle;return isFinite(d)&&isFinite(oe)&&(d<-Math.PI?d+=q:d>Math.PI&&(d-=q),oe<-Math.PI?oe+=q:oe>Math.PI&&(oe-=q),d<=oe?B.theta=Math.max(d,Math.min(oe,B.theta)):B.theta=B.theta>(d+oe)/2?Math.max(d,B.theta):Math.min(oe,B.theta)),B.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,B.phi)),B.makeSafe(),B.radius*=_e,B.radius=Math.max(r.minDistance,Math.min(r.maxDistance,B.radius)),r.enableDamping===!0?r.target.addScaledVector(ge,r.dampingFactor):r.target.add(ge),a.setFromSpherical(B),a.applyQuaternion(f),vt.copy(r.target).add(a),r.object.lookAt(r.target),r.enableDamping===!0?(J.theta*=1-r.dampingFactor,J.phi*=1-r.dampingFactor,ge.multiplyScalar(1-r.dampingFactor)):(J.set(0,0,0),ge.set(0,0,0)),_e=1,Te||O.distanceToSquared(r.object.position)>De||8*(1-W.dot(r.object.quaternion))>De?(r.dispatchEvent(fe),O.copy(r.object.position),W.copy(r.object.quaternion),Te=!1,!0):!1}})(),this.connect=a=>{a===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),r.domElement=a,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",ct),r.domElement.addEventListener("pointerdown",it),r.domElement.addEventListener("pointercancel",st),r.domElement.addEventListener("wheel",Ke)},this.dispose=()=>{var a,p,f,O,W,q;(a=r.domElement)==null||a.removeEventListener("contextmenu",ct),(p=r.domElement)==null||p.removeEventListener("pointerdown",it),(f=r.domElement)==null||f.removeEventListener("pointercancel",st),(O=r.domElement)==null||O.removeEventListener("wheel",Ke),(W=r.domElement)==null||W.ownerDocument.removeEventListener("pointermove",We),(q=r.domElement)==null||q.ownerDocument.removeEventListener("pointerup",je),r._domElementKeyEvents!==null&&r._domElementKeyEvents.removeEventListener("keydown",lt)};const r=this,fe={type:"change"},ve={type:"start"},X={type:"end"},b={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let L=b.NONE;const De=1e-6,B=new Tt,J=new Tt;let _e=1;const ge=new Oe;let Te=!1;const pe=new ye,me=new ye,le=new ye,re=new ye,S=new ye,M=new ye,C=new ye,U=new ye,D=new ye,E=[],w={};function Z(){return 2*Math.PI/60/60*r.autoRotateSpeed}function I(){return Math.pow(.95,r.zoomSpeed)}function $(a){r.reverseOrbit?J.theta+=a:J.theta-=a}function Ne(a){r.reverseOrbit?J.phi+=a:J.phi-=a}const ce=(()=>{const a=new Oe;return function(f,O){a.setFromMatrixColumn(O,0),a.multiplyScalar(-f),ge.add(a)}})(),ue=(()=>{const a=new Oe;return function(f,O){r.screenSpacePanning===!0?a.setFromMatrixColumn(O,1):(a.setFromMatrixColumn(O,0),a.crossVectors(r.object.up,a)),a.multiplyScalar(f),ge.add(a)}})(),Se=(()=>{const a=new Oe;return function(f,O){const W=r.domElement;if(W&&r.object instanceof bt&&r.object.isPerspectiveCamera){const q=r.object.position;a.copy(q).sub(r.target);let V=a.length();V*=Math.tan(r.object.fov/2*Math.PI/180),ce(2*f*V/W.clientHeight,r.object.matrix),ue(2*O*V/W.clientHeight,r.object.matrix)}else W&&r.object instanceof wt&&r.object.isOrthographicCamera?(ce(f*(r.object.right-r.object.left)/r.object.zoom/W.clientWidth,r.object.matrix),ue(O*(r.object.top-r.object.bottom)/r.object.zoom/W.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function te(a){r.object instanceof bt&&r.object.isPerspectiveCamera?_e/=a:r.object instanceof wt&&r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*a)),r.object.updateProjectionMatrix(),Te=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function ae(a){r.object instanceof bt&&r.object.isPerspectiveCamera?_e*=a:r.object instanceof wt&&r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/a)),r.object.updateProjectionMatrix(),Te=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function Pe(a){pe.set(a.clientX,a.clientY)}function be(a){C.set(a.clientX,a.clientY)}function Fe(a){re.set(a.clientX,a.clientY)}function we(a){me.set(a.clientX,a.clientY),le.subVectors(me,pe).multiplyScalar(r.rotateSpeed);const p=r.domElement;p&&($(2*Math.PI*le.x/p.clientHeight),Ne(2*Math.PI*le.y/p.clientHeight)),pe.copy(me),r.update()}function xe(a){U.set(a.clientX,a.clientY),D.subVectors(U,C),D.y>0?te(I()):D.y<0&&ae(I()),C.copy(U),r.update()}function Ge(a){S.set(a.clientX,a.clientY),M.subVectors(S,re).multiplyScalar(r.panSpeed),Se(M.x,M.y),re.copy(S),r.update()}function tt(a){a.deltaY<0?ae(I()):a.deltaY>0&&te(I()),r.update()}function z(a){let p=!1;switch(a.code){case r.keys.UP:Se(0,r.keyPanSpeed),p=!0;break;case r.keys.BOTTOM:Se(0,-r.keyPanSpeed),p=!0;break;case r.keys.LEFT:Se(r.keyPanSpeed,0),p=!0;break;case r.keys.RIGHT:Se(-r.keyPanSpeed,0),p=!0;break}p&&(a.preventDefault(),r.update())}function Ae(){if(E.length==1)pe.set(E[0].pageX,E[0].pageY);else{const a=.5*(E[0].pageX+E[1].pageX),p=.5*(E[0].pageY+E[1].pageY);pe.set(a,p)}}function Re(){if(E.length==1)re.set(E[0].pageX,E[0].pageY);else{const a=.5*(E[0].pageX+E[1].pageX),p=.5*(E[0].pageY+E[1].pageY);re.set(a,p)}}function nt(){const a=E[0].pageX-E[1].pageX,p=E[0].pageY-E[1].pageY,f=Math.sqrt(a*a+p*p);C.set(0,f)}function Et(){r.enableZoom&&nt(),r.enablePan&&Re()}function rt(){r.enableZoom&&nt(),r.enableRotate&&Ae()}function at(a){if(E.length==1)me.set(a.pageX,a.pageY);else{const f=Ve(a),O=.5*(a.pageX+f.x),W=.5*(a.pageY+f.y);me.set(O,W)}le.subVectors(me,pe).multiplyScalar(r.rotateSpeed);const p=r.domElement;p&&($(2*Math.PI*le.x/p.clientHeight),Ne(2*Math.PI*le.y/p.clientHeight)),pe.copy(me)}function Ye(a){if(E.length==1)S.set(a.pageX,a.pageY);else{const p=Ve(a),f=.5*(a.pageX+p.x),O=.5*(a.pageY+p.y);S.set(f,O)}M.subVectors(S,re).multiplyScalar(r.panSpeed),Se(M.x,M.y),re.copy(S)}function Xe(a){const p=Ve(a),f=a.pageX-p.x,O=a.pageY-p.y,W=Math.sqrt(f*f+O*O);U.set(0,W),D.set(0,Math.pow(U.y/C.y,r.zoomSpeed)),te(D.y),C.copy(U)}function ot(a){r.enableZoom&&Xe(a),r.enablePan&&Ye(a)}function ft(a){r.enableZoom&&Xe(a),r.enableRotate&&at(a)}function it(a){var p,f;r.enabled!==!1&&(E.length===0&&((p=r.domElement)==null||p.ownerDocument.addEventListener("pointermove",We),(f=r.domElement)==null||f.ownerDocument.addEventListener("pointerup",je)),ut(a),a.pointerType==="touch"?qe(a):gt(a))}function We(a){r.enabled!==!1&&(a.pointerType==="touch"?St(a):_t(a))}function je(a){var p,f,O;Le(a),E.length===0&&((p=r.domElement)==null||p.releasePointerCapture(a.pointerId),(f=r.domElement)==null||f.ownerDocument.removeEventListener("pointermove",We),(O=r.domElement)==null||O.ownerDocument.removeEventListener("pointerup",je)),r.dispatchEvent(X),L=b.NONE}function st(a){Le(a)}function gt(a){let p;switch(a.button){case 0:p=r.mouseButtons.LEFT;break;case 1:p=r.mouseButtons.MIDDLE;break;case 2:p=r.mouseButtons.RIGHT;break;default:p=-1}switch(p){case Be.DOLLY:if(r.enableZoom===!1)return;be(a),L=b.DOLLY;break;case Be.ROTATE:if(a.ctrlKey||a.metaKey||a.shiftKey){if(r.enablePan===!1)return;Fe(a),L=b.PAN}else{if(r.enableRotate===!1)return;Pe(a),L=b.ROTATE}break;case Be.PAN:if(a.ctrlKey||a.metaKey||a.shiftKey){if(r.enableRotate===!1)return;Pe(a),L=b.ROTATE}else{if(r.enablePan===!1)return;Fe(a),L=b.PAN}break;default:L=b.NONE}L!==b.NONE&&r.dispatchEvent(ve)}function _t(a){if(r.enabled!==!1)switch(L){case b.ROTATE:if(r.enableRotate===!1)return;we(a);break;case b.DOLLY:if(r.enableZoom===!1)return;xe(a);break;case b.PAN:if(r.enablePan===!1)return;Ge(a);break}}function Ke(a){r.enabled===!1||r.enableZoom===!1||L!==b.NONE&&L!==b.ROTATE||(a.preventDefault(),r.dispatchEvent(ve),tt(a),r.dispatchEvent(X))}function lt(a){r.enabled===!1||r.enablePan===!1||z(a)}function qe(a){switch(ht(a),E.length){case 1:switch(r.touches.ONE){case Ze.ROTATE:if(r.enableRotate===!1)return;Ae(),L=b.TOUCH_ROTATE;break;case Ze.PAN:if(r.enablePan===!1)return;Re(),L=b.TOUCH_PAN;break;default:L=b.NONE}break;case 2:switch(r.touches.TWO){case Ze.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Et(),L=b.TOUCH_DOLLY_PAN;break;case Ze.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;rt(),L=b.TOUCH_DOLLY_ROTATE;break;default:L=b.NONE}break;default:L=b.NONE}L!==b.NONE&&r.dispatchEvent(ve)}function St(a){switch(ht(a),L){case b.TOUCH_ROTATE:if(r.enableRotate===!1)return;at(a),r.update();break;case b.TOUCH_PAN:if(r.enablePan===!1)return;Ye(a),r.update();break;case b.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;ot(a),r.update();break;case b.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;ft(a),r.update();break;default:L=b.NONE}}function ct(a){r.enabled!==!1&&a.preventDefault()}function ut(a){E.push(a)}function Le(a){delete w[a.pointerId];for(let p=0;p<E.length;p++)if(E[p].pointerId==a.pointerId){E.splice(p,1);return}}function ht(a){let p=w[a.pointerId];p===void 0&&(p=new ye,w[a.pointerId]=p),p.set(a.pageX,a.pageY)}function Ve(a){const p=a.pointerId===E[0].pointerId?E[1]:E[0];return w[p.pointerId]}K!==void 0&&this.connect(K),this.update()}}class nn extends Rt{constructor(A){super(A),this.type=Ce}parse(A){const b=function(S,M){switch(S){case 1:console.error("THREE.RGBELoader Read Error: "+(M||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(M||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(M||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(M||""))}return-1},J=`
`,_e=function(S,M,C){M=M||1024;let D=S.pos,E=-1,w=0,Z="",I=String.fromCharCode.apply(null,new Uint16Array(S.subarray(D,D+128)));for(;0>(E=I.indexOf(J))&&w<M&&D<S.byteLength;)Z+=I,w+=I.length,D+=128,I+=String.fromCharCode.apply(null,new Uint16Array(S.subarray(D,D+128)));return-1<E?(C!==!1&&(S.pos+=w+E+1),Z+I.slice(0,E)):!1},ge=function(S){const M=/^#\?(\S+)/,C=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,U=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,D=/^\s*FORMAT=(\S+)\s*$/,E=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,w={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Z,I;if(S.pos>=S.byteLength||!(Z=_e(S)))return b(1,"no header found");if(!(I=Z.match(M)))return b(3,"bad initial token");for(w.valid|=1,w.programtype=I[1],w.string+=Z+`
`;Z=_e(S),Z!==!1;){if(w.string+=Z+`
`,Z.charAt(0)==="#"){w.comments+=Z+`
`;continue}if((I=Z.match(C))&&(w.gamma=parseFloat(I[1])),(I=Z.match(U))&&(w.exposure=parseFloat(I[1])),(I=Z.match(D))&&(w.valid|=2,w.format=I[1]),(I=Z.match(E))&&(w.valid|=4,w.height=parseInt(I[1],10),w.width=parseInt(I[2],10)),w.valid&2&&w.valid&4)break}return w.valid&2?w.valid&4?w:b(3,"missing image size specifier"):b(3,"missing format specifier")},Te=function(S,M,C){const U=M;if(U<8||U>32767||S[0]!==2||S[1]!==2||S[2]&128)return new Uint8Array(S);if(U!==(S[2]<<8|S[3]))return b(3,"wrong scanline width");const D=new Uint8Array(4*M*C);if(!D.length)return b(4,"unable to allocate buffer space");let E=0,w=0;const Z=4*U,I=new Uint8Array(4),$=new Uint8Array(Z);let Ne=C;for(;Ne>0&&w<S.byteLength;){if(w+4>S.byteLength)return b(1);if(I[0]=S[w++],I[1]=S[w++],I[2]=S[w++],I[3]=S[w++],I[0]!=2||I[1]!=2||(I[2]<<8|I[3])!=U)return b(3,"bad rgbe scanline format");let ce=0,ue;for(;ce<Z&&w<S.byteLength;){ue=S[w++];const te=ue>128;if(te&&(ue-=128),ue===0||ce+ue>Z)return b(3,"bad scanline data");if(te){const ae=S[w++];for(let Pe=0;Pe<ue;Pe++)$[ce++]=ae}else $.set(S.subarray(w,w+ue),ce),ce+=ue,w+=ue}const Se=U;for(let te=0;te<Se;te++){let ae=0;D[E]=$[te+ae],ae+=U,D[E+1]=$[te+ae],ae+=U,D[E+2]=$[te+ae],ae+=U,D[E+3]=$[te+ae],E+=4}Ne--}return D},pe=function(S,M,C,U){const D=S[M+3],E=Math.pow(2,D-128)/255;C[U+0]=S[M+0]*E,C[U+1]=S[M+1]*E,C[U+2]=S[M+2]*E,C[U+3]=1},me=function(S,M,C,U){const D=S[M+3],E=Math.pow(2,D-128)/255;C[U+0]=ze.toHalfFloat(Math.min(S[M+0]*E,65504)),C[U+1]=ze.toHalfFloat(Math.min(S[M+1]*E,65504)),C[U+2]=ze.toHalfFloat(Math.min(S[M+2]*E,65504)),C[U+3]=ze.toHalfFloat(1)},le=new Uint8Array(A);le.pos=0;const re=ge(le);if(re!==-1){const S=re.width,M=re.height,C=Te(le.subarray(le.pos),S,M);if(C!==-1){let U,D,E;switch(this.type){case He:E=C.length/4;const w=new Float32Array(E*4);for(let I=0;I<E;I++)pe(C,I*4,w,I*4);U=w,D=He;break;case Ce:E=C.length/4;const Z=new Uint16Array(E*4);for(let I=0;I<E;I++)me(C,I*4,Z,I*4);U=Z,D=Ce;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:S,height:M,data:U,header:re.string,gamma:re.gamma,exposure:re.exposure,type:D}}}return null}setDataType(A){return this.type=A,this}load(A,K,r,fe){function ve(X,b){switch(X.type){case He:case Ce:"colorSpace"in X?X.colorSpace="srgb-linear":X.encoding=3e3,X.minFilter=dt,X.magFilter=dt,X.generateMipmaps=!1,X.flipY=!0;break}K&&K(X,b)}return super.load(A,ve,r,fe)}}const et="colorSpace"in new Wt;class rn extends Rt{constructor(A){super(A),this.type=Ce}parse(A){const w=Math.pow(2.7182818,2.2);function Z(e,t){for(var n=0,o=0;o<65536;++o)(o==0||e[o>>3]&1<<(o&7))&&(t[n++]=o);for(var i=n-1;n<65536;)t[n++]=0;return i}function I(e){for(var t=0;t<16384;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}const $={l:0,c:0,lc:0};function Ne(e,t,n,o,i){for(;n<e;)t=t<<8|O(o,i),n+=8;n-=e,$.l=t>>n&(1<<e)-1,$.c=t,$.lc=n}const ce=new Array(59);function ue(e){for(var t=0;t<=58;++t)ce[t]=0;for(var t=0;t<65537;++t)ce[e[t]]+=1;for(var n=0,t=58;t>0;--t){var o=n+ce[t]>>1;ce[t]=n,n=o}for(var t=0;t<65537;++t){var i=e[t];i>0&&(e[t]=i|ce[i]++<<6)}}function Se(e,t,n,o,i,s,c){for(var l=n,v=0,h=0;i<=s;i++){if(l.value-n.value>o)return!1;Ne(6,v,h,e,l);var m=$.l;if(v=$.c,h=$.lc,c[i]=m,m==63){if(l.value-n.value>o)throw"Something wrong with hufUnpackEncTable";Ne(8,v,h,e,l);var u=$.l+6;if(v=$.c,h=$.lc,i+u>s+1)throw"Something wrong with hufUnpackEncTable";for(;u--;)c[i++]=0;i--}else if(m>=59){var u=m-59+2;if(i+u>s+1)throw"Something wrong with hufUnpackEncTable";for(;u--;)c[i++]=0;i--}}ue(c)}function te(e){return e&63}function ae(e){return e>>6}function Pe(e,t,n,o){for(;t<=n;t++){var i=ae(e[t]),s=te(e[t]);if(i>>s)throw"Invalid table entry";if(s>14){var c=o[i>>s-14];if(c.len)throw"Invalid table entry";if(c.lit++,c.p){var l=c.p;c.p=new Array(c.lit);for(var v=0;v<c.lit-1;++v)c.p[v]=l[v]}else c.p=new Array(1);c.p[c.lit-1]=t}else if(s)for(var h=0,v=1<<14-s;v>0;v--){var c=o[(i<<14-s)+h];if(c.len||c.p)throw"Invalid table entry";c.len=s,c.lit=t,h++}}return!0}const be={c:0,lc:0};function Fe(e,t,n,o){e=e<<8|O(n,o),t+=8,be.c=e,be.lc=t}const we={c:0,lc:0};function xe(e,t,n,o,i,s,c,l,v,h){if(e==t){o<8&&(Fe(n,o,i,c),n=be.c,o=be.lc),o-=8;var m=n>>o,m=new Uint8Array([m])[0];if(v.value+m>h)return!1;for(var u=l[v.value-1];m-- >0;)l[v.value++]=u}else if(v.value<h)l[v.value++]=e;else return!1;we.c=n,we.lc=o}function Ge(e){return e&65535}function tt(e){var t=Ge(e);return t>32767?t-65536:t}const z={a:0,b:0};function Ae(e,t){var n=tt(e),o=tt(t),i=o,s=n+(i&1)+(i>>1),c=s,l=s-i;z.a=c,z.b=l}function Re(e,t){var n=Ge(e),o=Ge(t),i=n-(o>>1)&65535,s=o+i-32768&65535;z.a=s,z.b=i}function nt(e,t,n,o,i,s,c){for(var l=c<16384,v=n>i?i:n,h=1,m;h<=v;)h<<=1;for(h>>=1,m=h,h>>=1;h>=1;){for(var u=0,j=u+s*(i-m),g=s*h,_=s*m,T=o*h,R=o*m,k,H,Q,ie;u<=j;u+=_){for(var x=u,Ie=u+o*(n-m);x<=Ie;x+=R){var G=x+T,ee=x+g,Me=ee+T;l?(Ae(e[x+t],e[ee+t]),k=z.a,Q=z.b,Ae(e[G+t],e[Me+t]),H=z.a,ie=z.b,Ae(k,H),e[x+t]=z.a,e[G+t]=z.b,Ae(Q,ie),e[ee+t]=z.a,e[Me+t]=z.b):(Re(e[x+t],e[ee+t]),k=z.a,Q=z.b,Re(e[G+t],e[Me+t]),H=z.a,ie=z.b,Re(k,H),e[x+t]=z.a,e[G+t]=z.b,Re(Q,ie),e[ee+t]=z.a,e[Me+t]=z.b)}if(n&h){var ee=x+g;l?Ae(e[x+t],e[ee+t]):Re(e[x+t],e[ee+t]),k=z.a,e[ee+t]=z.b,e[x+t]=k}}if(i&h)for(var x=u,Ie=u+o*(n-m);x<=Ie;x+=R){var G=x+T;l?Ae(e[x+t],e[G+t]):Re(e[x+t],e[G+t]),k=z.a,e[G+t]=z.b,e[x+t]=k}m=h,h>>=1}return u}function Et(e,t,n,o,i,s,c,l,v,h){for(var m=0,u=0,j=l,g=Math.trunc(i.value+(s+7)/8);i.value<g;)for(Fe(m,u,n,i),m=be.c,u=be.lc;u>=14;){var _=m>>u-14&16383,T=t[_];if(T.len)u-=T.len,xe(T.lit,c,m,u,n,o,i,v,h,j),m=we.c,u=we.lc;else{if(!T.p)throw"hufDecode issues";var R;for(R=0;R<T.lit;R++){for(var k=te(e[T.p[R]]);u<k&&i.value<g;)Fe(m,u,n,i),m=be.c,u=be.lc;if(u>=k&&ae(e[T.p[R]])==(m>>u-k&(1<<k)-1)){u-=k,xe(T.p[R],c,m,u,n,o,i,v,h,j),m=we.c,u=we.lc;break}}if(R==T.lit)throw"hufDecode issues"}}var H=8-s&7;for(m>>=H,u-=H;u>0;){var T=t[m<<14-u&16383];if(T.len)u-=T.len,xe(T.lit,c,m,u,n,o,i,v,h,j),m=we.c,u=we.lc;else throw"hufDecode issues"}return!0}function rt(e,t,n,o,i,s){var c={value:0},l=n.value,v=f(t,n),h=f(t,n);n.value+=4;var m=f(t,n);if(n.value+=4,v<0||v>=65537||h<0||h>=65537)throw"Something wrong with HUF_ENCSIZE";var u=new Array(65537),j=new Array(16384);I(j);var g=o-(n.value-l);if(Se(e,t,n,g,v,h,u),m>8*(o-(n.value-l)))throw"Something wrong with hufUncompress";Pe(u,v,h,j),Et(u,j,e,t,n,m,h,s,i,c)}function at(e,t,n){for(var o=0;o<n;++o)t[o]=e[t[o]]}function Ye(e){for(var t=1;t<e.length;t++){var n=e[t-1]+e[t]-128;e[t]=n}}function Xe(e,t){for(var n=0,o=Math.floor((e.length+1)/2),i=0,s=e.length-1;!(i>s||(t[i++]=e[n++],i>s));)t[i++]=e[o++]}function ot(e){for(var t=e.byteLength,n=new Array,o=0,i=new DataView(e);t>0;){var s=i.getInt8(o++);if(s<0){var c=-s;t-=c+1;for(var l=0;l<c;l++)n.push(i.getUint8(o++))}else{var c=s;t-=2;for(var v=i.getUint8(o++),l=0;l<c+1;l++)n.push(v)}}return n}function ft(e,t,n,o,i,s){var G=new DataView(s.buffer),c=n[e.idx[0]].width,l=n[e.idx[0]].height,v=3,h=Math.floor(c/8),m=Math.ceil(c/8),u=Math.ceil(l/8),j=c-(m-1)*8,g=l-(u-1)*8,_={value:0},T=new Array(v),R=new Array(v),k=new Array(v),H=new Array(v),Q=new Array(v);for(let F=0;F<v;++F)Q[F]=t[e.idx[F]],T[F]=F<1?0:T[F-1]+m*u,R[F]=new Float32Array(64),k[F]=new Uint16Array(64),H[F]=new Uint16Array(m*64);for(let F=0;F<u;++F){var ie=8;F==u-1&&(ie=g);var x=8;for(let Y=0;Y<m;++Y){Y==m-1&&(x=j);for(let P=0;P<v;++P)k[P].fill(0),k[P][0]=i[T[P]++],it(_,o,k[P]),We(k[P],R[P]),je(R[P]);st(R);for(let P=0;P<v;++P)gt(R[P],H[P],Y*64)}let ne=0;for(let Y=0;Y<v;++Y){const P=n[e.idx[Y]].type;for(let Ee=8*F;Ee<8*F+ie;++Ee){ne=Q[Y][Ee];for(let ke=0;ke<h;++ke){const he=ke*64+(Ee&7)*8;G.setUint16(ne+0*2*P,H[Y][he+0],!0),G.setUint16(ne+1*2*P,H[Y][he+1],!0),G.setUint16(ne+2*2*P,H[Y][he+2],!0),G.setUint16(ne+3*2*P,H[Y][he+3],!0),G.setUint16(ne+4*2*P,H[Y][he+4],!0),G.setUint16(ne+5*2*P,H[Y][he+5],!0),G.setUint16(ne+6*2*P,H[Y][he+6],!0),G.setUint16(ne+7*2*P,H[Y][he+7],!0),ne+=8*2*P}}if(h!=m)for(let Ee=8*F;Ee<8*F+ie;++Ee){const ke=Q[Y][Ee]+8*h*2*P,he=h*64+(Ee&7)*8;for(let Ue=0;Ue<x;++Ue)G.setUint16(ke+Ue*2*P,H[Y][he+Ue],!0)}}}for(var Ie=new Uint16Array(c),G=new DataView(s.buffer),ee=0;ee<v;++ee){n[e.idx[ee]].decoded=!0;var Me=n[e.idx[ee]].type;if(n[ee].type==2)for(var Je=0;Je<l;++Je){const F=Q[ee][Je];for(var de=0;de<c;++de)Ie[de]=G.getUint16(F+de*2*Me,!0);for(var de=0;de<c;++de)G.setFloat32(F+de*2*Me,d(Ie[de]),!0)}}}function it(e,t,n){for(var o,i=1;i<64;)o=t[e.value],o==65280?i=64:o>>8==255?i+=o&255:(n[i]=o,i++),e.value++}function We(e,t){t[0]=d(e[0]),t[1]=d(e[1]),t[2]=d(e[5]),t[3]=d(e[6]),t[4]=d(e[14]),t[5]=d(e[15]),t[6]=d(e[27]),t[7]=d(e[28]),t[8]=d(e[2]),t[9]=d(e[4]),t[10]=d(e[7]),t[11]=d(e[13]),t[12]=d(e[16]),t[13]=d(e[26]),t[14]=d(e[29]),t[15]=d(e[42]),t[16]=d(e[3]),t[17]=d(e[8]),t[18]=d(e[12]),t[19]=d(e[17]),t[20]=d(e[25]),t[21]=d(e[30]),t[22]=d(e[41]),t[23]=d(e[43]),t[24]=d(e[9]),t[25]=d(e[11]),t[26]=d(e[18]),t[27]=d(e[24]),t[28]=d(e[31]),t[29]=d(e[40]),t[30]=d(e[44]),t[31]=d(e[53]),t[32]=d(e[10]),t[33]=d(e[19]),t[34]=d(e[23]),t[35]=d(e[32]),t[36]=d(e[39]),t[37]=d(e[45]),t[38]=d(e[52]),t[39]=d(e[54]),t[40]=d(e[20]),t[41]=d(e[22]),t[42]=d(e[33]),t[43]=d(e[38]),t[44]=d(e[46]),t[45]=d(e[51]),t[46]=d(e[55]),t[47]=d(e[60]),t[48]=d(e[21]),t[49]=d(e[34]),t[50]=d(e[37]),t[51]=d(e[47]),t[52]=d(e[50]),t[53]=d(e[56]),t[54]=d(e[59]),t[55]=d(e[61]),t[56]=d(e[35]),t[57]=d(e[36]),t[58]=d(e[48]),t[59]=d(e[49]),t[60]=d(e[57]),t[61]=d(e[58]),t[62]=d(e[62]),t[63]=d(e[63])}function je(e){const t=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),o=.5*Math.cos(3.14159/8),i=.5*Math.cos(3*3.14159/16),s=.5*Math.cos(5*3.14159/16),c=.5*Math.cos(3*3.14159/8),l=.5*Math.cos(7*3.14159/16);for(var v=new Array(4),h=new Array(4),m=new Array(4),u=new Array(4),j=0;j<8;++j){var g=j*8;v[0]=o*e[g+2],v[1]=c*e[g+2],v[2]=o*e[g+6],v[3]=c*e[g+6],h[0]=n*e[g+1]+i*e[g+3]+s*e[g+5]+l*e[g+7],h[1]=i*e[g+1]-l*e[g+3]-n*e[g+5]-s*e[g+7],h[2]=s*e[g+1]-n*e[g+3]+l*e[g+5]+i*e[g+7],h[3]=l*e[g+1]-s*e[g+3]+i*e[g+5]-n*e[g+7],m[0]=t*(e[g+0]+e[g+4]),m[3]=t*(e[g+0]-e[g+4]),m[1]=v[0]+v[3],m[2]=v[1]-v[2],u[0]=m[0]+m[1],u[1]=m[3]+m[2],u[2]=m[3]-m[2],u[3]=m[0]-m[1],e[g+0]=u[0]+h[0],e[g+1]=u[1]+h[1],e[g+2]=u[2]+h[2],e[g+3]=u[3]+h[3],e[g+4]=u[3]-h[3],e[g+5]=u[2]-h[2],e[g+6]=u[1]-h[1],e[g+7]=u[0]-h[0]}for(var _=0;_<8;++_)v[0]=o*e[16+_],v[1]=c*e[16+_],v[2]=o*e[48+_],v[3]=c*e[48+_],h[0]=n*e[8+_]+i*e[24+_]+s*e[40+_]+l*e[56+_],h[1]=i*e[8+_]-l*e[24+_]-n*e[40+_]-s*e[56+_],h[2]=s*e[8+_]-n*e[24+_]+l*e[40+_]+i*e[56+_],h[3]=l*e[8+_]-s*e[24+_]+i*e[40+_]-n*e[56+_],m[0]=t*(e[_]+e[32+_]),m[3]=t*(e[_]-e[32+_]),m[1]=v[0]+v[3],m[2]=v[1]-v[2],u[0]=m[0]+m[1],u[1]=m[3]+m[2],u[2]=m[3]-m[2],u[3]=m[0]-m[1],e[0+_]=u[0]+h[0],e[8+_]=u[1]+h[1],e[16+_]=u[2]+h[2],e[24+_]=u[3]+h[3],e[32+_]=u[3]-h[3],e[40+_]=u[2]-h[2],e[48+_]=u[1]-h[1],e[56+_]=u[0]-h[0]}function st(e){for(var t=0;t<64;++t){var n=e[0][t],o=e[1][t],i=e[2][t];e[0][t]=n+1.5747*i,e[1][t]=n-.1873*o-.4682*i,e[2][t]=n+1.8556*o}}function gt(e,t,n){for(var o=0;o<64;++o)t[n+o]=ze.toHalfFloat(_t(e[o]))}function _t(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(w,Math.abs(e)-1)}function Ke(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function lt(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(ot(t)),o=new Uint8Array(n.length);return Ye(n),Xe(n,o),new DataView(o.buffer)}function qe(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size),n=mt(t),o=new Uint8Array(n.length);return Ye(n),Xe(n,o),new DataView(o.buffer)}function St(e){for(var t=e.viewer,n={value:e.offset.value},o=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),i=new Uint8Array(8192),s=0,c=new Array(e.channels),l=0;l<e.channels;l++)c[l]={},c[l].start=s,c[l].end=c[l].start,c[l].nx=e.width,c[l].ny=e.lines,c[l].size=e.type,s+=c[l].nx*c[l].ny*c[l].size;var v=oe(t,n),h=oe(t,n);if(h>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(v<=h)for(var l=0;l<h-v+1;l++)i[l+v]=W(t,n);var m=new Uint16Array(65536),u=Z(i,m),j=f(t,n);rt(e.array,t,n,j,o,s);for(var l=0;l<e.channels;++l)for(var g=c[l],_=0;_<c[l].size;++_)nt(o,g.start+_,g.nx,g.size,g.ny,g.nx*g.size,u);at(m,o,s);for(var T=0,R=new Uint8Array(o.buffer.byteLength),k=0;k<e.lines;k++)for(var H=0;H<e.channels;H++){var g=c[H],Q=g.nx*g.size,ie=new Uint8Array(o.buffer,g.end*2,Q*2);R.set(ie,T),T+=Q*2,g.end+=Q}return new DataView(R.buffer)}function ct(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size),n=mt(t);const o=e.lines*e.channels*e.width,i=e.type==1?new Uint16Array(o):new Uint32Array(o);let s=0,c=0;const l=new Array(4);for(let v=0;v<e.lines;v++)for(let h=0;h<e.channels;h++){let m=0;switch(e.type){case 1:l[0]=s,l[1]=l[0]+e.width,s=l[1]+e.width;for(let u=0;u<e.width;++u){const j=n[l[0]++]<<8|n[l[1]++];m+=j,i[c]=m,c++}break;case 2:l[0]=s,l[1]=l[0]+e.width,l[2]=l[1]+e.width,s=l[2]+e.width;for(let u=0;u<e.width;++u){const j=n[l[0]++]<<24|n[l[1]++]<<16|n[l[2]++]<<8;m+=j,i[c]=m,c++}break}}return new DataView(i.buffer)}function ut(e){var t=e.viewer,n={value:e.offset.value},o=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),i={version:q(t,n),unknownUncompressedSize:q(t,n),unknownCompressedSize:q(t,n),acCompressedSize:q(t,n),dcCompressedSize:q(t,n),rleCompressedSize:q(t,n),rleUncompressedSize:q(t,n),rleRawSize:q(t,n),totalAcUncompressedCount:q(t,n),totalDcUncompressedCount:q(t,n),acCompression:q(t,n)};if(i.version<2)throw"EXRLoader.parse: "+Qe.compression+" version "+i.version+" is unsupported";for(var s=new Array,c=oe(t,n)-2;c>0;){var l=Le(t.buffer,n),v=W(t,n),h=v>>2&3,m=(v>>4)-1,u=new Int8Array([m])[0],j=W(t,n);s.push({name:l,index:u,type:j,compression:h}),c-=l.length+3}for(var g=Qe.channels,_=new Array(e.channels),T=0;T<e.channels;++T){var R=_[T]={},k=g[T];R.name=k.name,R.compression=0,R.decoded=!1,R.type=k.pixelType,R.pLinear=k.pLinear,R.width=e.width,R.height=e.lines}for(var H={idx:new Array(3)},Q=0;Q<e.channels;++Q)for(var R=_[Q],T=0;T<s.length;++T){var ie=s[T];R.name==ie.name&&(R.compression=ie.compression,ie.index>=0&&(H.idx[ie.index]=Q),R.offset=Q)}if(i.acCompressedSize>0)switch(i.acCompression){case 0:var G=new Uint16Array(i.totalAcUncompressedCount);rt(e.array,t,n,i.acCompressedSize,G,i.totalAcUncompressedCount);break;case 1:var x=e.array.slice(n.value,n.value+i.totalAcUncompressedCount),Ie=mt(x),G=new Uint16Array(Ie.buffer);n.value+=i.totalAcUncompressedCount;break}if(i.dcCompressedSize>0){var ee={array:e.array,offset:n,size:i.dcCompressedSize},Me=new Uint16Array(qe(ee).buffer);n.value+=i.dcCompressedSize}if(i.rleRawSize>0){var x=e.array.slice(n.value,n.value+i.rleCompressedSize),Ie=mt(x),Je=ot(Ie.buffer);n.value+=i.rleCompressedSize}for(var de=0,F=new Array(_.length),T=0;T<F.length;++T)F[T]=new Array;for(var ne=0;ne<e.lines;++ne)for(var Y=0;Y<_.length;++Y)F[Y].push(de),de+=_[Y].width*e.type*2;ft(H,F,_,G,Me,o);for(var T=0;T<_.length;++T){var R=_[T];if(!R.decoded)switch(R.compression){case 2:for(var P=0,Ee=0,ne=0;ne<e.lines;++ne){for(var ke=F[T][P],he=0;he<R.width;++he){for(var Ue=0;Ue<2*R.type;++Ue)o[ke++]=Je[Ee+Ue*R.width*R.height];Ee++}P++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(o.buffer)}function Le(e,t){for(var n=new Uint8Array(e),o=0;n[t.value+o]!=0;)o+=1;var i=new TextDecoder().decode(n.slice(t.value,t.value+o));return t.value=t.value+o+1,i}function ht(e,t,n){var o=new TextDecoder().decode(new Uint8Array(e).slice(t.value,t.value+n));return t.value=t.value+n,o}function Ve(e,t){var n=p(e,t),o=f(e,t);return[n,o]}function a(e,t){var n=f(e,t),o=f(e,t);return[n,o]}function p(e,t){var n=e.getInt32(t.value,!0);return t.value=t.value+4,n}function f(e,t){var n=e.getUint32(t.value,!0);return t.value=t.value+4,n}function O(e,t){var n=e[t.value];return t.value=t.value+1,n}function W(e,t){var n=e.getUint8(t.value);return t.value=t.value+1,n}const q=function(e,t){let n;return"getBigInt64"in DataView.prototype?n=Number(e.getBigInt64(t.value,!0)):n=e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,n};function V(e,t){var n=e.getFloat32(t.value,!0);return t.value+=4,n}function vt(e,t){return ze.toHalfFloat(V(e,t))}function d(e){var t=(e&31744)>>10,n=e&1023;return(e>>15?-1:1)*(t?t===31?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):6103515625e-14*(n/1024))}function oe(e,t){var n=e.getUint16(t.value,!0);return t.value+=2,n}function Mt(e,t){return d(oe(e,t))}function Nt(e,t,n,o){for(var i=n.value,s=[];n.value<i+o-1;){var c=Le(t,n),l=p(e,n),v=W(e,n);n.value+=3;var h=p(e,n),m=p(e,n);s.push({name:c,pixelType:l,pLinear:v,xSampling:h,ySampling:m})}return n.value+=1,s}function Ut(e,t){var n=V(e,t),o=V(e,t),i=V(e,t),s=V(e,t),c=V(e,t),l=V(e,t),v=V(e,t),h=V(e,t);return{redX:n,redY:o,greenX:i,greenY:s,blueX:c,blueY:l,whiteX:v,whiteY:h}}function Ot(e,t){var n=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],o=W(e,t);return n[o]}function Ct(e,t){var n=f(e,t),o=f(e,t),i=f(e,t),s=f(e,t);return{xMin:n,yMin:o,xMax:i,yMax:s}}function Dt(e,t){var n=["INCREASING_Y"],o=W(e,t);return n[o]}function Pt(e,t){var n=V(e,t),o=V(e,t);return[n,o]}function Lt(e,t){var n=V(e,t),o=V(e,t),i=V(e,t);return[n,o,i]}function kt(e,t,n,o,i){if(o==="string"||o==="stringvector"||o==="iccProfile")return ht(t,n,i);if(o==="chlist")return Nt(e,t,n,i);if(o==="chromaticities")return Ut(e,n);if(o==="compression")return Ot(e,n);if(o==="box2i")return Ct(e,n);if(o==="lineOrder")return Dt(e,n);if(o==="float")return V(e,n);if(o==="v2f")return Pt(e,n);if(o==="v3f")return Lt(e,n);if(o==="int")return p(e,n);if(o==="rational")return Ve(e,n);if(o==="timecode")return a(e,n);if(o==="preview")return n.value+=i,"skipped";n.value+=i}function Ft(e,t,n){const o={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";o.version=e.getUint8(4);const i=e.getUint8(5);o.spec={singleTile:!!(i&2),longName:!!(i&4),deepFormat:!!(i&8),multiPart:!!(i&16)},n.value=8;for(var s=!0;s;){var c=Le(t,n);if(c==0)s=!1;else{var l=Le(t,n),v=f(e,n),h=kt(e,t,n,l,v);h===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${l}'.`):o[c]=h}}if(i!=0)throw console.error("EXRHeader:",o),"THREE.EXRLoader: provided file is currently unsupported.";return o}function Bt(e,t,n,o,i){const s={size:0,viewer:t,array:n,offset:o,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[et?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":s.lines=1,s.uncompress=Ke;break;case"RLE_COMPRESSION":s.lines=1,s.uncompress=lt;break;case"ZIPS_COMPRESSION":s.lines=1,s.uncompress=qe;break;case"ZIP_COMPRESSION":s.lines=16,s.uncompress=qe;break;case"PIZ_COMPRESSION":s.lines=32,s.uncompress=St;break;case"PXR24_COMPRESSION":s.lines=16,s.uncompress=ct;break;case"DWAA_COMPRESSION":s.lines=32,s.uncompress=ut;break;case"DWAB_COMPRESSION":s.lines=256,s.uncompress=ut;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(s.scanlineBlockSize=s.lines,s.type==1)switch(i){case He:s.getter=Mt,s.inputSize=2;break;case Ce:s.getter=oe,s.inputSize=2;break}else if(s.type==2)switch(i){case He:s.getter=V,s.inputSize=4;break;case Ce:s.getter=vt,s.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+s.type+" for "+e.compression+".";s.blockCount=(e.dataWindow.yMax+1)/s.scanlineBlockSize;for(var c=0;c<s.blockCount;c++)q(t,o);s.outputChannels=s.channels==3?4:s.channels;const l=s.width*s.height*s.outputChannels;switch(i){case He:s.byteArray=new Float32Array(l),s.channels<s.outputChannels&&s.byteArray.fill(1,0,l);break;case Ce:s.byteArray=new Uint16Array(l),s.channels<s.outputChannels&&s.byteArray.fill(15360,0,l);break;default:console.error("THREE.EXRLoader: unsupported type: ",i);break}return s.bytesPerLine=s.width*s.inputSize*s.channels,s.outputChannels==4?s.format=jt:s.format=Kt,et?s.colorSpace="srgb-linear":s.encoding=3e3,s}const pt=new DataView(A),Zt=new Uint8Array(A),$e={value:0},Qe=Ft(pt,A,$e),N=Bt(Qe,pt,Zt,$e,this.type),It={value:0},zt={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<N.height/N.scanlineBlockSize;e++){const t=f(pt,$e);N.size=f(pt,$e),N.lines=t+N.scanlineBlockSize>N.height?N.height-t:N.scanlineBlockSize;const o=N.size<N.lines*N.bytesPerLine?N.uncompress(N):Ke(N);$e.value+=N.size;for(let i=0;i<N.scanlineBlockSize;i++){const s=i+e*N.scanlineBlockSize;if(s>=N.height)break;for(let c=0;c<N.channels;c++){const l=zt[Qe.channels[c].name];for(let v=0;v<N.width;v++){It.value=(i*(N.channels*N.width)+c*N.width+v)*N.inputSize;const h=(N.height-1-s)*(N.width*N.outputChannels)+v*N.outputChannels+l;N.byteArray[h]=N.getter(o,It)}}}}return{header:Qe,width:N.width,height:N.height,data:N.byteArray,format:N.format,[et?"colorSpace":"encoding"]:N[et?"colorSpace":"encoding"],type:this.type}}setDataType(A){return this.type=A,this}load(A,K,r,fe){function ve(X,b){et?X.colorSpace=b.colorSpace:X.encoding=b.encoding,X.minFilter=dt,X.magFilter=dt,X.generateMipmaps=!1,X.flipY=!1,K&&K(X,b)}return super.load(A,ve,r,fe)}}export{rn as E,en as G,tn as O,nn as R};
